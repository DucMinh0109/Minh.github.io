<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhà Hàng Ngon - Đăng Nhập</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #f9f9f9; color: #333; }
        header { background-color: #ff6b35; color: white; padding: 1rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .logo { font-size: 1.8rem; font-weight: bold; }
        nav ul { display: flex; list-style: none; }
        nav ul li { margin-left: 1.5rem; }
        nav ul li a { color: white; text-decoration: none; }
        .page-title { background-color: #2e4057; color: white; padding: 2rem 0; text-align: center; }
        .login-container { max-width: 500px; margin: 0 auto; background: white; border-radius: 10px; padding: 2rem; }
        .tab { display: flex; margin-bottom: 2rem; }
        .tab-item { flex: 1; padding: 1rem; text-align: center; cursor: pointer; }
        .tab-item.active { color: #ff6b35; border-bottom: 3px solid #ff6b35; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group input { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; }
        .btn { width: 100%; background: #ff6b35; color: white; padding: 0.8rem; border: none; border-radius: 5px; cursor: pointer; }
        footer { background: #2e4057; color: white; padding: 2rem 0; text-align: center; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Nhà Hàng Ngon</div>
                <nav>
                    <ul>
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li><a href="menu.html">Thực Đơn</a></li>
                        <li><a href="#">Giới Thiệu</a></li>
                        <li><a href="#">Liên Hệ</a></li>
                        <li><a href="cart.html">Giỏ Hàng</a></li>
                        <li><a href="account.html" id="auth-link">Tài Khoản</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <section class="page-title">
        <div class="container"><h1>Đăng Nhập / Đăng Ký</h1></div>
    </section>
    <section class="login-section">
        <div class="container">
            <div class="login-container">
                <div class="tab">
                    <div class="tab-item active" data-tab="login">Đăng Nhập</div>
                    <div class="tab-item" data-tab="register">Đăng Ký</div>
                </div>
                <div class="form-content active" id="login">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-phone">Số Điện Thoại</label>
                            <input type="tel" id="login-phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Mật Khẩu</label>
                            <input type="password" id="login-password" name="password" required>
                        </div>
                        <button type="submit" class="btn">Đăng Nhập</button>
                    </form>
                </div>
                <div class="form-content" id="register">
                    <form id="register-form">
                        <div class="form-group">
                            <label for="register-name">Họ Tên</label>
                            <input type="text" id="register-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="register-phone">Số Điện Thoại</label>
                            <input type="tel" id="register-phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">Email</label>
                            <input type="email" id="register-email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="register-password">Mật Khẩu</label>
                            <input type="password" id="register-password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="register-birthday">Ngày Sinh</label>
                            <input type="date" id="register-birthday" name="birthday">
                        </div>
                        <button type="submit" class="btn">Đăng Ký</button>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <footer>
        <div class="container">
            <p>© 2025 Nhà Hàng Ngon. Tất cả quyền được bảo lưu.</p>
        </div>
    </footer>
    <script>
        const tabItems = document.querySelectorAll('.tab-item');
        const formContents = document.querySelectorAll('.form-content');
        const authLink = document.getElementById('auth-link');

        // Kiểm tra trạng thái đăng nhập
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        if (isLoggedIn) {
            authLink.textContent = 'Tài Khoản';
            authLink.href = 'account.html';
        } else {
            authLink.textContent = 'Đăng Nhập';
            authLink.href = 'login.html';
        }

        tabItems.forEach(item => {
            item.addEventListener('click', () => {
                tabItems.forEach(i => i.classList.remove('active'));
                formContents.forEach(f => f.classList.remove('active'));
                item.classList.add('active');
                document.getElementById(item.dataset.tab).classList.add('active');
            });
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = document.getElementById('login-phone').value;
            const password = document.getElementById('login-password').value;
            try {
                const response = await fetch('http://localhost:3000/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, password })
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userId', data.user.id);
                    localStorage.setItem('userName', data.user.name);
                    localStorage.setItem('userPhone', data.user.phone);
                    localStorage.setItem('userEmail', data.user.email || '');
                    localStorage.setItem('userBirthday', data.user.birthday || '');
                    alert(data.message);
                    window.location.href = 'account.html';
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('Lỗi kết nối server');
            }
        });

        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const phone = document.getElementById('register-phone').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const birthday = document.getElementById('register-birthday').value;
            try {
                const response = await fetch('http://localhost:3000/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, phone, email, password, birthday })
                });
                const data = await response.json();
                if (response.ok) {
                    alert(data.message);
                    tabItems.forEach(i => i.classList.remove('active'));
                    formContents.forEach(f => f.classList.remove('active'));
                    document.querySelector('.tab-item[data-tab="login"]').classList.add('active');
                    document.getElementById('login').classList.add('active');
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('Lỗi kết nối server');
            }
        });
    </script>
</body>
</html>